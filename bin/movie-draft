#!/usr/bin/env node


var fs         = require('fs'),

    pkg        = JSON.parse(fs.readFileSync(__dirname + '/../package.json', 'utf8')),

    program    = require('commander'),
    MovieDraft = require('../dist/' + pkg.name + '.min.js'),

    movieDraft,
    movies;


program
    .version(pkg.version)

    .option('-i, --input <file.json>', 'input JSON file. defaults to input.json')
    .option('-o, --output <file>', 'output text file. defaults to output.txt');


// parse command-line arguments

program.parse(process.argv);


// default input file to `input.json`

program.input = program.input || 'input.json';

try {
    movies = JSON.parse(
        fs.readFileSync(program.input, 'utf8')
            .trim()
    );
} catch (e) {
    throw new Error('Input file (' + program.input + ') could not be read.');
}


movieDraft = new MovieDraft({
    'movies': movies,
    'output': program.output || 'output.txt'
});


movieDraft.run(process.exit);
