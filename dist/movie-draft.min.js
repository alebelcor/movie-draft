/*!
 * movie-draft v0.0.2-dev
 * https://github.com/alebelcor/movie-draft.git
 *
 * Copyright (c) 2013 Alejandro BeltrÃ¡n 
 * Licensed MIT
 *
 * Date: 2013-11-17
 */


function MovieDraft(a){"use strict";a=a||{},this.data=[],this.movies=a.movies,this.output=a.output}var fs=require("fs"),request=require("request"),cheerio=require("cheerio"),entities=require("entities");MovieDraft.prototype.getData=function(a){"use strict";var b,c,d,e=this,f="http://boxofficemojo.com/movies/?id="+a.id;return request.get(f,function(a,f,g){var h;if(a)throw a;d=cheerio.load(g),b=d("td > font > b").html(),b=entities.decode(b).replace("<br>"," "),c=d("td:first-child > font > b").html(),c=null===c||-1===c.indexOf("$")?"N/A":c.replace(" (Estimate)",""),h={name:b,revenue:c},e.data[e.data.length]=h,e.save(h)}),this},MovieDraft.prototype.getAllData=function(){"use strict";var a,b;for(a=0,b=this.movies.length;b>a;a+=1)this.getData(this.movies[a]);return this},MovieDraft.prototype.save=function(a){"use strict";var b="";return b=a.name+" ->"+a.revenue+"\n",fs.appendFile(this.output,b),this},MovieDraft.prototype.run=function(){"use strict";fs.openSync(this.output,"w"),this.getAllData()},exports=module.exports=MovieDraft;